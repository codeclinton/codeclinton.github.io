<!DOCTYPE html>
<html>
<head>
	<title>
	  
	    Mustache, ERB and the future of templating
	  
	</title>
	<link rel="shortcut icon" href="http://freqn.aws.af.cm/images/favicon.ico">
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<script src="http://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov;stencil-std;cabin;shuriken-std.js"></script>

	<script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
	<link rel="stylesheet" href="/css/base.css" type="text/css" />
	<link rel="stylesheet" href="/css/font-awesome.min.css">
	<link rel="alternate" href="http://freqn.com/feed/" type="application/rss+xml" />

  <script type="text/javascript" src="//use.typekit.net/oih2jiw.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-XXXXXXXX']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</head>
<body>

  <div class="container">
    <header>
      <ul class="nav">
				<li><a href="/">Home</a></li>
				<li><a href="/blog">Blog</a></li>
				<li><a href="/projects">Projects</a></li>
        <li><a href="/about">About</a></li>
        <li><a href="/contact">Contact</a></li>
      </ul>
    </header>

    <p class="date">October 17, 2011</p>
<h1 class="words">Mustache, ERB and the future of templating</h1>
<p>There are days that I feel like I&rsquo;ve spent the better part of my life inside templating languages. I&rsquo;ve rocked hundreds of different styles of templates over the past 8 years. Smarty,  vBulletin templates, generations of Wordpress, J2EE, XSLT, CFML, ERB, HAML, Mustache and every form of in-house bastardized template language that exists.</p>

<p>So when I say that <a href="http://mustache.github.com">{{ mustache }}</a> is my favorite templating language I&rsquo;ve ever worked with, I mean it with a great deal of sincerity and experience. It&rsquo;s syntactically elegant, focused on output (HTML), encourages documentation, and discourages unmaintainable magic. I want to use it everywhere.</p>

<h2>I mustache you, why mustache?</h2>

<div class="figure"><img src="http://assets.warpspire.com/images/mustache-erb/mustache.png" alt=-"Mustache - Logic-less template" /></div>


<p>Mustache is more than a syntax. It&rsquo;s a different approach to traditional templating â€” mustache templates have no logic. The template files themselves are HTML and mustaches:</p>

<div class="highlight"><pre><code class="html"><div class='line' id='LC1'><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;devlist&quot;</span><span class="nt">&gt;</span></div><div class='line' id='LC2'>&nbsp;&nbsp;<span class="cp">{{</span><span class="cp">#</span><span class="nv">developers</span><span class="cp">}}</span></div><div class='line' id='LC3'>&nbsp;&nbsp;<span class="nt">&lt;tr&gt;</span></div><div class='line' id='LC4'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span></div><div class='line' id='LC5'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;h4&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">show_url</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span> <span class="nt">&lt;em&gt;</span>(<span class="cp">{{</span> <span class="nv">github_username</span> <span class="cp">}}</span>)<span class="nt">&lt;/em&gt;&lt;/h4&gt;</span></div><div class='line' id='LC6'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;languages&quot;</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">languages</span> <span class="cp">}}</span><span class="nt">&lt;/p&gt;</span></div><div class='line' id='LC7'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;/td&gt;</span></div><div class='line' id='LC8'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;location&quot;</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">location</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span></div><div class='line' id='LC9'>&nbsp;&nbsp;<span class="nt">&lt;/tr&gt;</span></div><div class='line' id='LC10'>&nbsp;&nbsp;<span class="cp">{{</span><span class="o">/</span><span class="nv">developers</span><span class="cp">}}</span></div><div class='line' id='LC11'><span class="nt">&lt;/table&gt;</span></div></code></pre></div>


<p>You cannot modify variables. You cannot apply filters. You can only output variables or a collection of variables. Everything else happens inside of a <em>view</em>. A view can be written in any language of your choosing: C, Objective-C, Ruby, Python, Javascript, etc. I&rsquo;ll use Ruby since that&rsquo;s what we use:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Jobs</span>
  <span class="k">module</span> <span class="nn">Views</span>
    <span class="k">class</span> <span class="nc">Developers</span> <span class="o">&lt;</span> <span class="no">Layout</span>

      <span class="k">def</span> <span class="nf">developers</span>
        <span class="vi">@results</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">hit</span><span class="o">|</span>
          <span class="nb">name</span> <span class="o">=</span> <span class="n">hit</span><span class="o">[</span><span class="s2">&quot;fullname&quot;</span><span class="o">].</span><span class="n">empty?</span> <span class="p">?</span> <span class="n">hit</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">].</span><span class="n">capitalize</span> <span class="p">:</span> <span class="n">hit</span><span class="o">[</span><span class="s2">&quot;fullname&quot;</span><span class="o">]</span>
          <span class="p">{</span>
            <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="nb">name</span><span class="p">,</span>
            <span class="ss">:github_username</span> <span class="o">=&gt;</span> <span class="n">hit</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">]</span><span class="p">,</span>
            <span class="ss">:location</span> <span class="o">=&gt;</span> <span class="n">hit</span><span class="o">[</span><span class="s2">&quot;location&quot;</span><span class="o">]</span><span class="p">,</span>
            <span class="ss">:show_url</span> <span class="o">=&gt;</span> <span class="s1">&#39;/developers/&#39;</span> <span class="o">+</span> <span class="n">hit</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">]</span><span class="p">,</span>
            <span class="ss">:languages</span> <span class="o">=&gt;</span> <span class="n">hit</span><span class="o">[</span><span class="s2">&quot;language&quot;</span><span class="o">]</span>
          <span class="p">}</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">developers_count</span>
        <span class="vi">@results</span><span class="o">.</span><span class="n">total_hits</span> <span class="k">rescue</span> <span class="mi">0</span>
      <span class="k">end</span>

    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>


<p>It&rsquo;s just a good old Ruby class. Oh the wonder you can do with a class! Include modules, extend classes (such as that Layout class), and define any method you so desire. With any documentation your heart desires (something that&rsquo;s missing from every templating strategy I&rsquo;ve ever used).</p>

<p>I thought I loved Mustache a year ago, but over time I&rsquo;ve learned just how revolutionary separating templates from views is toward maintainability and collaboration. Anyone who knows HTML can edit Mustache templates. And all the magic that happens on the whole <strong>V</strong> side of MVC can be fully documented and separated into re-usable Ruby classes and modules.</p>

<h2>You want me to switch templating languages on my legacy app?</h2>

<p>For all this talk, the application I spend most of my time working on is still ERB. In fact, the rails app that powers <a href="https://github.com">GitHub</a> has over <strong>500 erb templates</strong>. We have dozens of people throwing hundreds of commits a day at the codebase in over <strong>150 branches</strong>. Switching to Mustache would be a disaster requiring everyone to stop development, switch patterns, and introduce an unknown number of bugs to our customers. A shitty trade.</p>

<p>I don&rsquo;t want to stop new feature development, but I do want better templates. And I know that Mustache is the direction I&rsquo;d like to go. Luckily for me, I work with the smartest people in the world. A little while ago <a href="https://github.com/sr">Simon</a> introduced a new templating strategy that I really like.</p>

<h2>Mustache-style ERB templates</h2>

<p>We&rsquo;ve started using the mustache style but completely within ERB â€” we haven&rsquo;t modified the template rendering chain at all. Inside of a new helper, we&rsquo;ll create a view class:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">NavigationHelper</span>
  <span class="k">class</span> <span class="nc">RepositoryNavigationView</span>
    <span class="kp">include</span> <span class="no">ActionView</span><span class="o">::</span><span class="no">Helpers</span><span class="o">::</span><span class="no">NumberHelper</span>

    <span class="kp">attr_reader</span> <span class="ss">:current_user</span><span class="p">,</span> <span class="ss">:current_repository</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">repo</span><span class="p">)</span>
      <span class="vi">@current_user</span> <span class="o">=</span> <span class="n">user</span>
      <span class="vi">@current_repository</span> <span class="o">=</span> <span class="n">repo</span>
    <span class="k">end</span>

    <span class="c1"># What symbols should we trigger highlighting for various tabs?</span>
    <span class="c1">#</span>
    <span class="c1"># Returns an array of symbols.</span>
    <span class="k">def</span> <span class="nf">highlights_for_code</span>
      <span class="o">[</span><span class="ss">:repo_source</span><span class="p">,</span> <span class="ss">:repo_downloads</span><span class="p">,</span> <span class="ss">:repo_commits</span><span class="p">,</span> <span class="ss">:repo_tags</span><span class="p">,</span> <span class="ss">:repo_branches</span><span class="o">]</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">highlights_for_pulls</span>
      <span class="o">[</span><span class="ss">:repo_pulls</span><span class="o">]</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">highlights_for_issues</span>
      <span class="o">[</span><span class="ss">:repo_issues</span><span class="o">]</span>
    <span class="k">end</span>

    <span class="c1"># Should we show the wiki tab? We try and show it when it&#39;s useful to</span>
    <span class="c1"># someone using these rules:</span>
    <span class="c1">#</span>
    <span class="c1"># - Never show it if the wiki is disabled under the admin section.</span>
    <span class="c1"># - Show it if you have admin access to the repository</span>
    <span class="c1"># - Show it if there is content</span>
    <span class="c1">#</span>
    <span class="c1"># Returns true to show the tab.</span>
    <span class="k">def</span> <span class="nf">show_wiki?</span>
      <span class="k">return</span> <span class="kp">false</span> <span class="k">unless</span> <span class="n">current_repository</span><span class="o">.</span><span class="n">has_wiki?</span>
      <span class="k">return</span> <span class="kp">true</span> <span class="k">if</span> <span class="n">logged_in?</span> <span class="o">&amp;&amp;</span> <span class="n">current_repository</span><span class="o">.</span><span class="n">pushable_by?</span><span class="p">(</span><span class="n">current_user</span><span class="p">)</span>
      <span class="n">current_repository</span><span class="o">.</span><span class="n">wiki</span><span class="o">.</span><span class="n">page_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span></code></pre></div>


<p>Nicely documented, isolated from application-wide helpers and easy to find. Inside of the <code>html.erb</code>, create a new instance of this view object:</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="n">view</span> <span class="o">=</span> <span class="no">NavigationHelper</span><span class="o">::</span><span class="no">RepositoryNavigationView</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">current_user</span><span class="p">,</span> <span class="n">current_repository</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="cp">&lt;%</span> <span class="k">unless</span> <span class="vi">@omit_repository_toolbar</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;ul class=&quot;tabs&quot;&gt;</span>
<span class="x">    &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">selected_link_to</span> <span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="n">code_path</span><span class="p">,</span> <span class="ss">:highlight</span> <span class="o">=&gt;</span> <span class="n">view</span><span class="o">.</span><span class="n">highlights_for_code</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">selected_link_to</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span> <span class="n">network_path</span><span class="p">,</span> <span class="ss">:highlight</span> <span class="o">=&gt;</span> <span class="n">view</span><span class="o">.</span><span class="n">highlights_for_network</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">selected_link_to</span> <span class="s2">&quot;Pull Requests&quot;</span><span class="p">,</span> <span class="n">pull_requests_path</span><span class="p">,</span> <span class="ss">:highlight</span> <span class="o">=&gt;</span> <span class="n">view</span><span class="o">.</span><span class="n">highlights_for_pulls</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>

<span class="x">    </span><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">show_issues?</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">      &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">selected_link_to</span> <span class="s2">&quot;Issues&quot;</span><span class="p">,</span> <span class="n">issues_path</span><span class="p">,</span> <span class="ss">:highlight</span> <span class="o">=&gt;</span> <span class="n">view</span><span class="o">.</span><span class="n">highlights_for_issues</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">    </span><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">show_wiki?</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">      &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">selected_link_to</span> <span class="s2">&quot;Wiki&quot;</span><span class="p">,</span> <span class="n">wikis_path</span><span class="p">,</span> <span class="ss">:highlight</span> <span class="o">=&gt;</span> <span class="n">view</span><span class="o">.</span><span class="n">highlights_for_wiki</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">    &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">selected_link_to</span> <span class="s2">&quot;Stats &amp;amp; Graphs&quot;</span><span class="p">,</span> <span class="n">graphs_path</span><span class="p">,</span> <span class="ss">:highlight</span> <span class="o">=&gt;</span> <span class="n">view</span><span class="o">.</span><span class="n">highlights_for_graphs</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="x">  &lt;/ul&gt;</span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">render_subnav</span> <span class="s1">&#39;repositories/code&#39;</span><span class="p">,</span>        <span class="n">view</span><span class="o">.</span><span class="n">highlights_for_code</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">render_subnav</span> <span class="s1">&#39;repositories/network&#39;</span><span class="p">,</span>     <span class="n">view</span><span class="o">.</span><span class="n">highlights_for_network</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">render_subnav</span> <span class="s1">&#39;repositories/graphs&#39;</span><span class="p">,</span>      <span class="n">view</span><span class="o">.</span><span class="n">highlights_for_graphs</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">render_subnav</span> <span class="s1">&#39;repositories/wiki&#39;</span><span class="p">,</span>        <span class="n">view</span><span class="o">.</span><span class="n">highlights_for_wiki</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span></code></pre></div>


<p>If you&rsquo;re used to regular ERB templates it&rsquo;s immediately obvious where this data comes from â€” it&rsquo;s right at the top of the file! Ack the project for <code>RepositoryNavigationView</code> and you&rsquo;ve found your view class. No magic.</p>

<p>One huge advantage of this tactic is that you can still use all the same Rails/ERB shortcuts for quick prototyping. If someone doesn&rsquo;t want to learn the new template strategy right away, they can use the same methods they&rsquo;ve been using for years.</p>

<h2>Graceful upgrade path</h2>

<p>Switching templating languages is something that needs to be done gracefully when you&rsquo;re working with others. Ripping out everyone&rsquo;s foundation is a recipe for unhappy developers. Rails is all about patterns, and sticking to those patterns is really important.</p>

<p>This strategy allows us to slowly convert the codebase to a better documented, view/template separation that anyone who&rsquo;s worked with ERB can understand. And if we choose to switch to true-and-blue Mustache some day, our code will be 80% there already.</p>

<a class="twitter-icon" href="https://twitter.com/intent/tweet?text=&quot;Mustache, ERB and the future of templating&quot;%20localhost/blog/mustache-style-erb%20via%20&#64;freqn"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
    <i class="fa fa-twitter"></i>
</a>
<a class="facebook-icon" href="https://www.facebook.com/sharer/sharer.php?u=localhost/blog/mustache-style-erb"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="google-icon" href="https://plus.google.com/share?url=localhost/blog/mustache-style-erb"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
<div class="keep-in-touch">
  <p>
    If you'd like to keep in touch, I tweet <a href="https://twitter.com/kneath">@kneath</a> on Twitter. You're also welcome to send a polite email to <a href="mailto:kyle@warpspire.com">kyle@warpspire.com</a>. I don't always get the chance to respond, but email is always the best way to get in touch.
  </p>
  <p class="comments">
Comments on Warpspire are currently an experiment. Please, try to be a good human (or you will be removed).
  </p>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'warpspire';
    var disqus_identifier = '/blog/mustache-style-erb';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

		<p style="text-align: center;">Copyright &copy; <script type="text/javascript">document.write(new Date().getFullYear())</script> Freqn Labs, All Rights Reserved.</p>

  </div><!-- /.main -->

  <script type="text/javascript" src="/js/fastclick.js"></script>
  <script type="text/javascript">
    window.addEventListener('load', function() {
        new FastClick(document.body);
    }, false);
  </script>

</body>
</html>
